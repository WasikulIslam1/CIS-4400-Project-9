CREATE SCHEMA IF NOT EXISTS realestate;

CREATE TABLE realestate.dim_crimerate (
    crime_id VARCHAR NOT NULL,
    crimerate DECIMAL(10,5),
    typeofcrime VARCHAR(10),
    CONSTRAINT pk_dim_station PRIMARY KEY (crime_id)
);

CREATE  TABLE "realestate".dim_housingmarket ( 
	housing_id           integer  NOT NULL  ,
	state_id             varchar    ,
	county_name          varchar    ,
	houseaddress         varchar(100)    ,
	minsaleprice         numeric    ,
	maxsaleprice         numeric    ,
	mediansaleprice      numeric    ,
	averagesaleprice     numeric    ,
	CONSTRAINT pk_dim_sample PRIMARY KEY ( housing_id )
 );


CREATE TABLE realestate.dim_location (
    location_id VARCHAR NOT NULL,
    zipcode NUMERIC,
    latitude NUMERIC,
    longitude NUMERIC,
    state_id VARCHAR,
    CONSTRAINT pk_dim_date PRIMARY KEY (location_id)
);

CREATE TABLE realestate.dim_schoolrating (
    school_id NUMERIC NOT NULL,
    schoolrating NUMERIC(10,5),
    schoolname VARCHAR,
    CONSTRAINT pk_dim_collection PRIMARY KEY (school_id)
);

CREATE TABLE realestate.realestate_facts (
    housing_id VARCHAR NOT NULL,
    fact_id BIGINT NOT NULL,
    crime_id VARCHAR NOT NULL,
    school_id NUMERIC NOT NULL,
    location_id VARCHAR NOT NULL,  -- Changed to VARCHAR to match type in dim_location
    state_id VARCHAR(15) NOT NULL,
    listingprice NUMERIC NOT NULL,
    saleprice NUMERIC,
    minlivingwage NUMERIC,
    maxlivingwage NUMERIC,
    avglivingwage NUMERIC,
    CONSTRAINT pk_realestate_facts PRIMARY KEY (fact_id),
    CONSTRAINT fk_realestate_facts_housing_id FOREIGN KEY (housing_id) REFERENCES realestate.dim_housingmarket (housing_id),
    CONSTRAINT fk_realestate_facts_crime_id FOREIGN KEY (crime_id) REFERENCES realestate.dim_crimerate (crime_id),
    CONSTRAINT fk_realestate_facts_school_id FOREIGN KEY (school_id) REFERENCES realestate.dim_schoolrating (school_id),
    CONSTRAINT fk_realestate_facts_location_id FOREIGN KEY (location_id) REFERENCES realestate.dim_location (location_id)
);
